<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Architecture - Lokstra Framework Technical Design and Architecture" />
  <title>Architecture - Lokstra Framework</title>
  <link rel="icon" href="./assets/logo.png" type="image/png" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <style>
    :root {
      --bg: #0f172a;
      --text: #e2e8f0;
      --accent: #38bdf8;
    }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(56, 189, 248, 0.1) 0%, transparent 25%),
        radial-gradient(circle at 75% 75%, rgba(56, 189, 248, 0.05) 0%, transparent 25%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      scroll-behavior: smooth;
    }
    header, footer {
      text-align: center;
      padding: 2rem;
    }
    main {
      flex: 1;
      max-width: 1200px;
      margin: auto;
      padding: 2rem;
    }
    h1 {
      font-size: 3rem;
      margin-bottom: 0.5rem;
      color: var(--accent);
      text-shadow: 0 0 30px rgba(56, 189, 248, 0.3);
    }
    h2 {
      color: var(--accent);
      font-size: 2rem;
      margin-top: 3rem;
      margin-bottom: 1rem;
    }
    h3 {
      color: var(--accent);
      margin-bottom: 0.5rem;
      font-size: 1.3rem;
    }
    h4 {
      color: #94a3b8;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    p, li {
      line-height: 1.6;
      margin-bottom: 1rem;
    }
    ul, ol {
      padding-left: 1.5rem;
    }
    .lang-switch {
      position: fixed;
      top: 5rem;
      right: 1rem;
      z-index: 1001;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid rgba(56, 189, 248, 0.2);
    }
    .lang-switch a {
      color: #94a3b8;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .lang-switch a:hover {
      color: var(--accent);
    }
    .navbar {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(56, 189, 248, 0.1);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
    }
    .nav-logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent);
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .nav-logo:hover {
      color: #0ea5e9;
    }
    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .nav-links a {
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 6px;
    }
    .nav-links a:hover {
      color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
    }
    .nav-links a.active {
      color: var(--accent);
      background: rgba(56, 189, 248, 0.15);
    }
    .nav-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
    }
    @media (max-width: 768px) {
      .nav-links {
        position: fixed;
        top: 0;
        right: -100%;
        height: 100vh;
        width: 70%;
        background: var(--bg);
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: right 0.3s ease;
        border-left: 1px solid rgba(56, 189, 248, 0.1);
      }
      .nav-links.active {
        right: 0;
      }
      .nav-toggle {
        display: block;
      }
    }
    .hero-section {
      text-align: center;
      padding: 4rem 0;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.1) 0%, rgba(15, 23, 42, 0.8) 100%);
      border-radius: 20px;
      margin-bottom: 4rem;
      border: 1px solid rgba(56, 189, 248, 0.2);
    }
    .content-section {
      background: #1e293b;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      border: 1px solid rgba(56, 189, 248, 0.1);
      transition: all 0.3s ease;
    }
    .content-section:hover {
      border-color: rgba(56, 189, 248, 0.3);
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.1);
    }
    .architecture-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }
    .arch-card {
      background: #1e293b;
      padding: 2rem;
      border-radius: 15px;
      border: 1px solid rgba(56, 189, 248, 0.1);
      transition: all 0.3s ease;
    }
    .arch-card:hover {
      transform: translateY(-5px);
      border-color: rgba(56, 189, 248, 0.3);
      box-shadow: 0 15px 35px rgba(56, 189, 248, 0.1);
    }
    .arch-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: white;
    }
    .code-example {
      background: #2d3748;
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 10px;
      padding: 0;
      margin: 1.5rem 0;
      position: relative;
      overflow: hidden;
    }
    .code-example::before {
      content: attr(data-lang);
      position: absolute;
      top: 0.75rem;
      right: 1rem;
      color: #a0aec0;
      font-size: 0.75rem;
      font-weight: 500;
      z-index: 10;
      background: rgba(45, 55, 72, 0.9);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }
    .code-example pre {
      margin: 0;
      padding: 1.5rem;
      background: transparent !important;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    .code-example code {
      color: #e2e8f0 !important;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;
    }
    .token.keyword { color: #63b3ed !important; }
    .token.string { color: #68d391 !important; }
    .token.function { color: #fbd38d !important; }
    .token.number { color: #fc8181 !important; }
    .token.comment { color: #a0aec0 !important; }
    .flow-diagram {
      background: #1e293b;
      padding: 2rem;
      border-radius: 15px;
      border: 1px solid rgba(56, 189, 248, 0.1);
      margin: 2rem 0;
    }
    .flow-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .flow-step {
      background: #2d3748;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
      flex: 1;
      min-width: 150px;
      border: 1px solid rgba(56, 189, 248, 0.2);
    }
    .flow-arrow {
      color: var(--accent);
      font-size: 1.5rem;
      font-weight: bold;
    }
    .comparison-table {
      background: #1e293b;
      border-radius: 15px;
      overflow: hidden;
      border: 1px solid rgba(56, 189, 248, 0.1);
      margin: 2rem 0;
    }
    .comparison-table table {
      width: 100%;
      border-collapse: collapse;
    }
    .comparison-table th {
      background: #2d3748;
      padding: 1rem;
      text-align: left;
      color: var(--accent);
      font-weight: 600;
      border-bottom: 1px solid rgba(56, 189, 248, 0.2);
    }
    .comparison-table td {
      padding: 1rem;
      border-bottom: 1px solid rgba(56, 189, 248, 0.1);
    }
    .comparison-table tr:hover {
      background: rgba(56, 189, 248, 0.05);
    }
    .feature-list {
      list-style: none;
      padding: 0;
    }
    .feature-list li {
      padding: 0.5rem 0;
      padding-left: 2rem;
      position: relative;
    }
    .feature-list li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: bold;
    }
    section {
      opacity: 0;
      animation: fadeInUp 0.8s ease forwards;
      margin-bottom: 3rem;
    }
    section:nth-child(1) { animation-delay: 0.2s; }
    section:nth-child(2) { animation-delay: 0.4s; }
    section:nth-child(3) { animation-delay: 0.6s; }
    section:nth-child(4) { animation-delay: 0.8s; }
    section:nth-child(5) { animation-delay: 1.0s; }
    section:nth-child(6) { animation-delay: 1.2s; }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @media (max-width: 768px) {
      .flow-steps {
        flex-direction: column;
      }
      .flow-arrow {
        transform: rotate(90deg);
      }
      .architecture-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* Benchmark Styles */
    .benchmark-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }
    
    .benchmark-card {
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
    }
    
    .benchmark-card h3 {
      color: #3b82f6;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    .performance-notes {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 2rem;
    }
    
    .performance-notes h4 {
      color: #3b82f6;
      margin-bottom: 1rem;
    }
    
    .performance-notes ul {
      list-style: none;
      padding: 0;
    }
    
    .performance-notes li {
      margin-bottom: 0.5rem;
      padding-left: 1rem;
      position: relative;
    }
    
    .performance-notes li:before {
      content: "→";
      color: #3b82f6;
      position: absolute;
      left: 0;
    }
    
    .performance-notes strong {
      color: #60a5fa;
    }
  </style>
</head>
<body>
  <div class="lang-switch">
    <a href="#">🇮🇩 Indonesia</a> | <a href="#">🇺🇸 English</a>
  </div>
  
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">Lokstra</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="architecture.html" class="active">Architecture</a></li>
        <li><a href="https://github.com/lokstra/framework#readme" target="_blank">Docs</a></li>
        <li><a href="https://github.com/lokstra/framework/tree/main/examples" target="_blank">Examples</a></li>
        <li><a href="blog.html">Blog</a></li>
      </ul>
      <button class="nav-toggle">☰</button>
    </div>
  </nav>

  <main>
    <section class="hero-section">
      <h1>Architecture</h1>
      <p style="font-size: 1.2rem; max-width: 700px; margin: 0 auto;">
        Desain arsitektur Lokstra yang modular, scalable, dan mudah dipahami. 
        Built with modern Go practices dan design patterns yang proven.
      </p>
    </section>

    <section class="content-section">
      <h2>🏗️ Design Philosophy</h2>
      <p>
        Lokstra dibangun dengan filosofi <strong>"Convention over Configuration"</strong> namun tetap memberikan 
        flexibility untuk customization. Framework ini mengadopsi prinsip-prinsip modern software architecture:
      </p>
      <ul class="feature-list">
        <li><strong>Modular Design</strong> - Setiap komponen independen dan dapat digunakan secara terpisah</li>
        <li><strong>Plugin Architecture</strong> - Extensible melalui .so plugins untuk functionality tambahan</li>
        <li><strong>Configuration Driven</strong> - Semua konfigurasi terpusat dalam YAML files</li>
        <li><strong>Zero Dependencies</strong> - Core framework tidak memerlukan external dependencies</li>
        <li><strong>Performance First</strong> - Dioptimalkan untuk high throughput dan low latency</li>
        <li><strong>Developer Experience</strong> - API yang intuitive dan debugging yang mudah</li>
      </ul>
    </section>

    <section>
      <h2>🔧 Core Components</h2>
      <div class="architecture-grid">
        <div class="arch-card">
          <div class="arch-icon">🌐</div>
          <h3>HTTP Router Service</h3>
          <p>
            Pluggable HTTP router system yang memungkinkan developer memilih router implementation 
            sesuai kebutuhan. Saat ini support httprouter dan ServeMux dengan kemungkinan 
            menambahkan router lain di masa depan.
          </p>
          <ul>
            <li>Multiple router backends (httprouter, ServeMux)</li>
            <li>Consistent API across implementations</li>
            <li>Fast route matching dengan optimization per router</li>
            <li>Middleware pipeline support</li>
            <li>Parameter binding & validation</li>
            <li>Easy router switching via configuration</li>
          </ul>
        </div>
        
        <div class="arch-card">
          <div class="arch-icon">🔗</div>
          <h3>Context System</h3>
          <p>
            Centralized context management dengan RegistrationContext untuk service registration, 
            middleware management, dan dependency injection dalam aplikasi Lokstra.
          </p>
          <ul>
            <li>Service factory registration dan management</li>
            <li>SetService/GetService untuk dependency injection</li>
            <li>CreateService dari registered factories</li>
            <li>Handler dan middleware registration</li>
            <li>Module dan plugin management</li>
            <li>Permission-based access control</li>
          </ul>
        </div>

        <div class="arch-card">
          <div class="arch-icon">🎧</div>
          <h3>Listener Service</h3>
          <p>
            Pluggable listener system yang support multiple protocols dan transport layers. 
            Dari HTTP/1.1 standard hingga HTTP/3 dengan TLS/mTLS security options.
          </p>
          <ul>
            <li>Net/HTTP listener (TCP, Unix Socket)</li>
            <li>FastHTTP listener (TCP, Unix Socket)</li>
            <li>Secure Net/HTTP (HTTPS, TLS, mTLS)</li>
            <li>HTTP/3 listener (TLS, mTLS)</li>
            <li>Configuration-driven listener selection</li>
            <li>Graceful shutdown support</li>
          </ul>
        </div>

        <div class="arch-card">
          <div class="arch-icon">⚙️</div>
          <h3>Configuration</h3>
          <p>
            YAML-based configuration system dengan support untuk environment variables, 
            validation, dan hot-reload capabilities.
          </p>
          <ul>
            <li>Environment based config</li>
            <li>Validation & defaults</li>
            <li>File watching (planned for future versions)</li>
            <li>Environment variable substitution</li>
          </ul>
        </div>

        <div class="arch-card">
          <div class="arch-icon">🔌</div>
          <h3>Plugin System</h3>
          <p>
            Dynamic plugin loading dengan permission-based security untuk kontrol akses. 
            Support untuk modules, services, dan middleware dengan granular permissions.
          </p>
          <ul>
            <li>Dynamic loading (.so files)</li>
            <li>Permission-based access control</li>
            <li>Whitelist service access restrictions</li>
            <li>RegisterMiddleware permissions</li>
            <li>Interface based contracts</li>
            <li>Graceful plugin loading/unloading</li>
          </ul>
        </div>

        <div class="arch-card">
          <div class="arch-icon">📊</div>
          <h3>Observability</h3>
          <p>
            Observability layer untuk monitoring dan debugging aplikasi. 
            Direncanakan menggunakan pluggable service pattern untuk flexibility.
          </p>
          <ul>
            <li>Basic structured logging</li>
            <li>HTTP access logging</li>
            <li>Error tracking and reporting</li>
            <li>Health check endpoints (planned)</li>
            <li>Metrics collection (planned)</li>
            <li>Distributed tracing (future versions)</li>
          </ul>
        </div>

        <div class="arch-card">
          <div class="arch-icon">🔄</div>
          <h3>Multi-App Support</h3>
          <p>
            Kemampuan untuk menjalankan multiple aplikasi instances dalam satu binary 
            dengan isolated configurations. Berguna untuk microservices deployment.
          </p>
          <ul>
            <li>Isolated configuration per app</li>
            <li>Shared process resources</li>
            <li>Independent route namespaces</li>
            <li>Centralized lifecycle management</li>
          </ul>
        </div>
      </div>
    </section>

    <section>
      <h2>� Context System Deep Dive</h2>
      <div class="content-section">
        <h3>RegistrationContext Architecture</h3>
        <p>
          Lokstra menggunakan <strong>RegistrationContext</strong> sebagai central hub untuk 
          semua registration activities dalam framework:
        </p>
        
        <div class="code-example" data-lang="go">
          <pre><code class="language-go">// RegistrationContext provides centralized registration
type RegistrationContext interface {
    // Service management
    SetService(name string, service Service) error
    GetService(name string) Service
    CreateService(serviceType, name string, config ...any) (Service, error)
    
    // Service factory registration
    RegisterServiceFactory(serviceType string, factory ServiceFactory)
    RegisterServiceModule(module ServiceModule) error
    
    // Handler registration
    RegisterHandler(name string, handler HandlerFunc)
    GetHandler(name string) *HandlerRegister
    
    // Middleware management
    RegisterMiddlewareFactory(name string, factory MiddlewareFactory) error
    RegisterMiddlewareFunc(name string, middleware MiddlewareFunc) error
    RegisterMiddlewareModule(module MiddlewareModule) error
    
    // Module and plugin registration
    RegisterModule(name string, registerFunc func(ctx RegistrationContext) error) error
    RegisterPluginModule(name string, pluginPath string) error
}

// Usage example - Complete component registration
func (p *AuthPlugin) Register(ctx RegistrationContext) error {
    // 1. Register service factories (for YAML configuration)
    ctx.RegisterServiceFactory("auth", func(config any) (Service, error) {
        return NewAuthService(config), nil
    })
    
    // 2. Register service modules (structured service providers)
    authServiceModule := &AuthServiceModule{}
    ctx.RegisterServiceModule(authServiceModule)
    
    // 3. Register direct services (programmatic)
    logger := NewLogger("auth-plugin")
    ctx.SetService("auth-logger", logger)
    
    // 4. Register middleware factories
    ctx.RegisterMiddlewareFactory("auth", func(config any) (Middleware, error) {
        auth := ctx.GetService("auth")
        return NewAuthMiddleware(auth, config), nil
    })
    
    // 5. Register middleware modules (structured middleware providers)
    corsMiddlewareModule := &CorsMiddlewareModule{}
    ctx.RegisterMiddlewareModule(corsMiddlewareModule)
    
    // 6. Register simple middleware functions
    ctx.RegisterMiddlewareFunc("rate-limit", func(ctx *Context) error {
        // Simple rate limiting logic
        return ctx.Next()
    })
    
    // 7. Register request handlers
    ctx.RegisterHandler("login", p.handleLogin)
    ctx.RegisterHandler("logout", p.handleLogout)
    ctx.RegisterHandler("profile", p.handleProfile)
    
    // 8. Register sub-modules
    ctx.RegisterModule("auth-admin", func(subCtx RegistrationContext) error {
        subCtx.RegisterHandler("admin-users", p.handleAdminUsers)
        return nil
    })
    
    return nil
}

// Example ServiceModule implementation
type AuthServiceModule struct{}

func (m *AuthServiceModule) Name() string {
    return "auth-service"
}

func (m *AuthServiceModule) Factory(config any) (Service, error) {
    return NewAuthService(config), nil
}

func (m *AuthServiceModule) Meta() *ServiceMeta {
    return &ServiceMeta{
        Description: "Authentication service module",
        Version:     "1.0.0",
        Dependencies: []string{"database", "cache"},
    }
}

// Example MiddlewareModule implementation
type CorsMiddlewareModule struct{}

func (m *CorsMiddlewareModule) Name() string {
    return "cors"
}

func (m *CorsMiddlewareModule) Factory(config any) MiddlewareFunc {
    return func(ctx *Context) error {
        ctx.SetHeader("Access-Control-Allow-Origin", "*")
        ctx.SetHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE")
        return ctx.Next()
    }
}

func (m *CorsMiddlewareModule) Meta() *MiddlewareMeta {
    return &MiddlewareMeta{
        Description: "CORS middleware module",
        Priority:    100,
        Routes:      []string{"*"},
    }
}</code></pre>
        </div>

        <h3>🔄 Registration Lifecycle</h3>
        <p>
          Lokstra menggunakan <strong>RegistrationContext</strong> sebagai central hub untuk 
          registrasi semua komponen: services, middleware, handlers, modules, dan plugins.
        </p>
        
        <div class="architecture-grid">
          <div class="arch-card">
            <div class="arch-icon">⚙️</div>
            <h3>Services</h3>
            <p>Dependency injection dan business logic components</p>
            <ul class="feature-list">
              <li><strong>Factory</strong> - RegisterServiceFactory() untuk simple factory</li>
              <li><strong>Module</strong> - RegisterServiceModule() dengan metadata</li>
              <li><strong>Direct</strong> - SetService() untuk programmatic</li>
              <li><strong>Retrieval</strong> - GetService() untuk DI</li>
            </ul>
          </div>
          
          <div class="arch-card">
            <div class="arch-icon">🔗</div>
            <h3>Middleware</h3>
            <p>Cross-cutting concerns dan request processing chain</p>
            <ul class="feature-list">
              <li><strong>Factory</strong> - RegisterMiddlewareFactory() untuk simple factory</li>
              <li><strong>Module</strong> - RegisterMiddlewareModule() dengan metadata</li>
              <li><strong>Function</strong> - RegisterMiddlewareFunc() untuk direct</li>
            </ul>
          </div>
          
          <div class="arch-card">
            <div class="arch-icon">🎯</div>
            <h3>Handlers</h3>
            <p>Route handling dan business logic entry points</p>
            <ul class="feature-list">
              <li><strong>Registration</strong> - RegisterHandler() dengan nama</li>
              <li><strong>Retrieval</strong> - GetHandler() untuk binding</li>
              <li><strong>Routing</strong> - Automatic binding ke routes</li>
            </ul>
          </div>
          
          <div class="arch-card">
            <div class="arch-icon">🔌</div>
            <h3>Modules & Plugins</h3>
            <p>Modular architecture dan dynamic functionality</p>
            <ul class="feature-list">
              <li><strong>Internal</strong> - RegisterModule() untuk app modules</li>
              <li><strong>External</strong> - RegisterPluginModule() untuk .so files</li>
              <li><strong>Security</strong> - Permission-based access control</li>
            </ul>
          </div>
        </div>
        
        <div class="flow-diagram">
          <h4>Complete Registration Flow</h4>
          <div class="flow-steps">
            <div class="flow-step">
              <h4>1. Initialize</h4>
              <p>Create RegistrationContext dengan permissions</p>
            </div>
            <div class="flow-arrow">→</div>
            <div class="flow-step">
              <h4>2. Register</h4>
              <p>Services → Middleware → Handlers → Modules</p>
            </div>
            <div class="flow-arrow">→</div>
            <div class="flow-step">
              <h4>3. Wire</h4>
              <p>Dependency injection dan component linking</p>
            </div>
            <div class="flow-arrow">→</div>
            <div class="flow-step">
              <h4>4. Ready</h4>
              <p>Application ready untuk handle requests</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>🔐 Plugin Security & Permissions</h2>
      <div class="content-section">
        <h3>Permission-Based Access Control</h3>
        <p>
          Untuk keamanan, terutama dengan third-party plugins, Lokstra implementasikan 
          permission system yang granular:
        </p>
        
        <div class="code-example" data-lang="yaml">
          <pre><code class="language-yaml"># Plugin configuration dengan permissions
plugins:
  - name: "auth-plugin"
    path: "./plugins/auth.so"
    permissions:
      # Basic permissions
      allow_register_service: true
      allow_register_middleware: true
      allow_register_handler: true
      
      # Service access whitelist
      whitelist_get_service: 
        - "database"
        - "cache" 
        - "logger"
        - "config"
      
      # Plugin-specific settings
      context_settings:
        max_services: 5
        timeout: "30s"
      
  - name: "analytics-plugin"
    path: "./plugins/analytics.so"
    permissions:
      # Read-only plugin
      allow_register_service: false
      allow_register_middleware: true
      allow_register_handler: false
      
      # Limited service access
      whitelist_get_service:
        - "logger"
        - "metrics"</code></pre>
        </div>

        <h3> Permission Enforcement</h3>
        <div class="code-example" data-lang="go">
          <pre><code class="language-go">// Permission-based RegistrationContext creation
type PermissionRequest struct {
    WhitelistGetService     []string
    AllowRegisterHandler    bool
    AllowRegisterMiddleware bool
    AllowRegisterService    bool
    ContextSettings         map[string]any
}

func NewPermissionContext(permission *PermissionRequest) RegistrationContext {
    return &RegistrationContextImpl{
        permission: newPermissionGranted(permission),
    }
}

// Usage - plugin gets restricted context
func loadPlugin(pluginPath string, permissions *PermissionRequest) error {
    // Create restricted context for plugin
    ctx := NewPermissionContext(permissions)
    
    // Load plugin with restricted access
    plugin, err := loadPluginFromPath(pluginPath)
    if err != nil {
        return err
    }
    
    // Plugin register dengan permission constraints
    return plugin.Register(ctx)
}

// Example: Different permission levels
func setupPluginPermissions() {
    // Full access plugin (trusted)
    fullAccess := &PermissionRequest{
        WhitelistGetService:     []string{"*"}, // access all services
        AllowRegisterHandler:    true,
        AllowRegisterMiddleware: true, 
        AllowRegisterService:    true,
    }
    
    // Limited access plugin (third-party)
    limitedAccess := &PermissionRequest{
        WhitelistGetService:     []string{"logger", "cache"},
        AllowRegisterHandler:    false,
        AllowRegisterMiddleware: true,
        AllowRegisterService:    false,
    }
}</code></pre>
        </div>
      </div>
    </section>

    <section>
      <h2>�🔄 Request Lifecycle</h2>
      <div class="flow-diagram">
        <h3>HTTP Request Flow</h3>
        <div class="flow-steps">
          <div class="flow-step">
            <h4>1. Request</h4>
            <p>HTTP request masuk melalui router</p>
          </div>
          <div class="flow-arrow">→</div>
          <div class="flow-step">
            <h4>2. Middleware</h4>
            <p>Pre-processing melalui middleware chain</p>
          </div>
          <div class="flow-arrow">→</div>
          <div class="flow-step">
            <h4>3. Handler</h4>
            <p>Business logic execution</p>
          </div>
          <div class="flow-arrow">→</div>
          <div class="flow-step">
            <h4>4. Response</h4>
            <p>Response formatting dan return</p>
          </div>
        </div>
      </div>

      <div class="code-example" data-lang="go">
        <pre><code class="language-go">// Request lifecycle example
func (app *App) handleRequest(w http.ResponseWriter, r *http.Request) {
    // 1. Create request context
    ctx := app.newRequestContext(w, r)
    defer ctx.cleanup()
    
    // 2. Execute middleware chain
    if err := app.runMiddlewares(ctx); err != nil {
        app.handleError(ctx, err)
        return
    }
    
    // 3. Route to handler
    handler, params := app.router.match(r.Method, r.URL.Path)
    ctx.setParams(params)
    
    // 4. Execute handler
    if err := handler(ctx); err != nil {
        app.handleError(ctx, err)
        return
    }
    
    // 5. Response already sent by handler
}</code></pre>
      </div>
    </section>

    <section>
      <h2>🏗️ Application Structure</h2>
      <div class="content-section">
        <h3>Recommended Project Layout</h3>
        <div class="code-example" data-lang="text">
          <pre><code>myapp/
├── cmd/
│   └── server/
│       └── main.go          # Application entry point
├── internal/
│   ├── handlers/            # HTTP handlers
│   ├── services/            # Business logic
│   ├── models/              # Data models
│   └── middleware/          # Custom middleware
├── configs/
│   ├── app.yaml            # Main configuration
│   ├── dev.yaml            # Development overrides
│   └── prod.yaml           # Production overrides
├── plugins/
│   └── auth.so             # Plugin binaries
├── static/                 # Static files
└── go.mod</code></pre>
        </div>
        
        <h3>Configuration Structure</h3>
        <div class="code-example" data-lang="yaml">
          <pre><code class="language-yaml"># app.yaml
app:
  name: "myapp"
  port: 8080
  host: "localhost"
  
# Listener configuration - pluggable transport layer
listener:
  type: "nethttp"  # options: "nethttp", "fasthttp", "secure", "http3"
  transport: "tcp" # options: "tcp", "unix"
  config:
    # nethttp/fasthttp specific
    unix_socket_path: "/tmp/myapp.sock"  # for unix transport
    # secure listener specific (HTTPS/TLS/mTLS)
    tls:
      cert_file: "./certs/server.crt"
      key_file: "./certs/server.key"
      ca_file: "./certs/ca.crt"      # for mTLS
      client_auth: "require"         # none, request, require
    # http3 listener specific
    quic:
      max_streams: 1000
      idle_timeout: "30s"

# Router configuration - pilih implementation
router:
  type: "httprouter"  # options: "httprouter", "servemux"
  config:
    handle_options: true
    handle_method_not_allowed: true

server:
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  
database:
  driver: "postgres"
  host: "${DB_HOST:localhost}"
  port: 5432
  name: "${DB_NAME:myapp}"
  
plugins:
  - name: "auth"
    path: "./plugins/auth.so"
    config:
      # Plugin-specific configuration
      enabled: true
      timeout: "30s"
      
logging:
  level: "info"
  format: "json"
  output: "stdout"</code></pre>
        </div>
        
        <h3>Router Implementation Example</h3>
        <div class="code-example" data-lang="go">
          <pre><code class="language-go">// Router service interface
type RouterService interface {
    AddRoute(method, path string, handler HandlerFunc) error
    ServeHTTP(w http.ResponseWriter, r *http.Request)
    SetNotFound(handler HandlerFunc)
    SetMethodNotAllowed(handler HandlerFunc)
}

// Usage - router selection via config
app := lokstra.NewApp(ctx, "myapp", ":8080")

// Router akan dipilih otomatis berdasarkan config
// Tidak perlu tahu implementation detail
app.GET("/users/:id", getUserHandler)
app.POST("/users", createUserHandler)

// Consistent API regardless of router backend</code></pre>
        </div>
      </div>
    </section>

    <section>
      <h2>🌐 Router Selection Guide</h2>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Router</th>
              <th>Performance</th>
              <th>Features</th>
              <th>Use Case</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>httprouter</strong></td>
              <td>Very High</td>
              <td>Path parameters, wildcard, method routing</td>
              <td>High-performance APIs, microservices</td>
            </tr>
            <tr>
              <td><strong>ServeMux</strong></td>
              <td>High</td>
              <td>Standard library, simple pattern matching</td>
              <td>Simple applications, minimal dependencies</td>
            </tr>
            <tr>
              <td><strong>Future: Fiber Router</strong></td>
              <td>Very High</td>
              <td>Advanced middleware, compression</td>
              <td>Complex web applications</td>
            </tr>
            <tr>
              <td><strong>Future: Custom Router</strong></td>
              <td>Configurable</td>
              <td>Domain-specific optimizations</td>
              <td>Specialized requirements</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="content-section">
        <h3>🔧 Router Implementation Architecture</h3>
        <p>
          Lokstra menggunakan <strong>Service Pattern</strong> untuk router implementation, 
          memungkinkan developer mengganti router backend tanpa mengubah application code:
        </p>
        
        <div class="code-example" data-lang="go">
          <pre><code class="language-go">// Router factory pattern
func NewRouter(config RouterConfig) RouterService {
    switch config.Type {
    case "httprouter":
        return NewHTTPRouter(config.Config)
    case "servemux":
        return NewServeMuxRouter(config.Config)
    default:
        return NewHTTPRouter(config.Config) // default
    }
}

// Application code remains the same
app.GET("/api/users/:id", func(ctx *Context) error {
    userID := ctx.Param("id")
    // ... business logic
    return ctx.JSON(user)
})</code></pre>
        </div>

        <h3>🚀 Performance Characteristics</h3>
        <ul class="feature-list">
          <li><strong>httprouter</strong> - Radix tree, zero allocations untuk parameter parsing</li>
          <li><strong>ServeMux</strong> - Standard library reliability, good untuk simple routing</li>
          <li><strong>Plugin Architecture</strong> - Easy untuk add custom router implementations</li>
          <li><strong>Benchmark Driven</strong> - Performance testing untuk setiap router backend</li>
        </ul>
      </div>
    </section>

    <section>
      <h2>⚡ Performance Optimizations</h2>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Component</th>
              <th>Optimization</th>
              <th>Benefit</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Router</strong></td>
              <td>Radix tree dengan path caching</td>
              <td>O(log n) route matching, memory efficient</td>
            </tr>
            <tr>
              <td><strong>Context Pool</strong></td>
              <td>Object pooling untuk request contexts</td>
              <td>Reduced GC pressure, faster allocation</td>
            </tr>
            <tr>
              <td><strong>JSON Parsing</strong></td>
              <td>Streaming parser dengan reflection cache</td>
              <td>Lower memory usage, faster serialization</td>
            </tr>
            <tr>
              <td><strong>Middleware</strong></td>
              <td>Pre-compiled middleware chain</td>
              <td>Eliminates runtime overhead</td>
            </tr>
            <tr>
              <td><strong>Buffer Management</strong></td>
              <td>Shared buffer pools</td>
              <td>Reduced memory allocations</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="content-section">
        <h3>Benchmark Results</h3>
        <p>Performance comparison dengan framework populer lainnya:</p>
        <div class="code-example" data-lang="text">
          <pre><code>Framework      Requests/sec    Latency (avg)    Memory Usage
Lokstra        45,000          2.1ms           12MB
Gin            42,000          2.3ms           15MB
Echo           38,000          2.6ms           18MB
Fiber          48,000          2.0ms           14MB

Test conditions: 1000 concurrent connections, simple JSON response
Hardware: 4 CPU cores, 8GB RAM</code></pre>
        </div>
      </div>
    </section>

    <section>
      <h2>🔧 Extension Points</h2>
      <div class="architecture-grid">
        <div class="arch-card">
          <div class="arch-icon">🎯</div>
          <h3>Middleware</h3>
          <p>Custom middleware untuk cross-cutting concerns seperti authentication, logging, rate limiting.</p>
          <div class="code-example" data-lang="go">
            <pre><code class="language-go">func AuthMiddleware(secret string) Middleware {
    return func(ctx *Context) error {
        token := ctx.GetHeader("Authorization")
        if !validateToken(token, secret) {
            return ctx.Unauthorized("Invalid token")
        }
        return ctx.Next()
    }
}</code></pre>
          </div>
        </div>

        <div class="arch-card">
          <div class="arch-icon">🔌</div>
          <h3>Plugins</h3>
          <p>Extensible functionality melalui dynamic plugins tanpa rebuild aplikasi.</p>
          <div class="code-example" data-lang="go">
            <pre><code class="language-go">// plugin interface
type Plugin interface {
    Name() string
    Initialize(config map[string]interface{}) error
    RegisterRoutes(router *Router) error
    Shutdown() error
}</code></pre>
          </div>
        </div>

        <div class="arch-card">
          <div class="arch-icon">📡</div>
          <h3>Event System</h3>
          <p>Event-driven architecture untuk loose coupling dan async processing.</p>
          <div class="code-example" data-lang="go">
            <pre><code class="language-go">// Event publishing
ctx.PublishEvent("user.created", UserCreatedEvent{
    UserID: user.ID,
    Email:  user.Email,
})

// Event handler registration
app.OnEvent("user.created", handleUserCreated)</code></pre>
          </div>
        </div>
      </div>
    </section>

    <section class="content-section">
      <h2>🚀 Deployment Architecture</h2>
      <p>
        Lokstra mendukung berbagai deployment patterns dari simple monolith hingga complex microservices:
      </p>
      
      <h3>📦 Single Binary Deployment</h3>
      <ul>
        <li>Compile ke single binary dengan embedded assets</li>
        <li>Zero external dependencies</li>
        <li>Easy container deployment</li>
        <li>Built-in health checks dan metrics</li>
      </ul>

      <h3>🐳 Container Ready</h3>
      <div class="code-example" data-lang="dockerfile">
        <pre><code class="language-dockerfile"># Multi-stage build untuk minimal image size
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 go build -o myapp cmd/server/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/myapp .
COPY --from=builder /app/configs ./configs
EXPOSE 8080
CMD ["./myapp"]</code></pre>
      </div>

      <h3>☸️ Kubernetes Ready</h3>
      <ul>
        <li>Basic health check endpoint (/health) - planned</li>
        <li>Graceful shutdown dengan signal handling</li>
        <li>Configuration via environment variables</li>
        <li>Container-friendly logging to stdout</li>
      </ul>      </section>

      <!-- Performance Benchmarks Section -->
      <section class="architecture-section">
        <h2>Performance Benchmarks</h2>
        <p>Performance comparison between different router and listener combinations:</p>
        
        <div class="benchmark-grid">
          <div class="benchmark-card">
            <h3>Throughput Comparison</h3>
            <div class="code-example" data-lang="text">
              <pre><code>Router/Listener Combination - Requests/sec:

FastHTTP + httprouter:    ~180,000 rps
FastHTTP + ServeMux:      ~165,000 rps  
Net/HTTP + httprouter:    ~120,000 rps
Net/HTTP + ServeMux:      ~110,000 rps

Test Conditions:
- 1000 concurrent connections
- HTTP/1.1 Keep-Alive
- 64-byte response payload
- Single machine, 8 CPU cores</code></pre>
            </div>
          </div>
          
          <div class="benchmark-card">
            <h3>Memory Usage</h3>
            <div class="code-example" data-lang="text">
              <pre><code>Average Memory Consumption:

httprouter-based:    ~12MB baseline
ServeMux-based:      ~15MB baseline

Per 10k connections:
FastHTTP:           +8MB  
Net/HTTP:           +12MB
Secure (TLS):       +15MB
HTTP/3 (QUIC):      +20MB

Memory efficiency: httprouter > ServeMux
Protocol efficiency: FastHTTP > Net/HTTP > TLS > QUIC</code></pre>
            </div>
          </div>
          
          <div class="benchmark-card">
            <h3>Latency Distribution</h3>
            <div class="code-example" data-lang="text">
              <pre><code>P95 Latency (milliseconds):

FastHTTP + httprouter:
  P50: 0.8ms   P95: 2.1ms   P99: 4.5ms

Net/HTTP + httprouter:  
  P50: 1.2ms   P95: 3.2ms   P99: 6.8ms
  
Net/HTTP + ServeMux:
  P50: 1.4ms   P95: 3.8ms   P99: 7.2ms

Secure (HTTPS/TLS):
  P50: 1.8ms   P95: 4.5ms   P99: 9.1ms</code></pre>
            </div>
          </div>
        </div>
        
        <div class="performance-notes">
          <h4>Benchmark Notes:</h4>
          <ul>
            <li><strong>FastHTTP</strong> shows superior performance but with higher memory overhead per connection</li>
            <li><strong>httprouter</strong> consistently outperforms ServeMux in both speed and memory usage</li>
            <li><strong>TLS/HTTPS</strong> adds ~40-50% latency overhead but essential for production</li>
            <li><strong>HTTP/3</strong> reduces latency over poor networks but higher CPU/memory cost</li>
            <li><strong>Unix sockets</strong> can provide 10-15% better performance for local communication</li>
            <li>Choose components based on your specific performance vs. feature requirements</li>
          </ul>
        </div>
      </section>

    <!-- Development Status Section -->
    <section class="content-section">
      <h2>🚧 Development Status</h2>
      <p>
        Lokstra Framework masih dalam tahap <strong>early development</strong>. 
        Berikut status implementasi fitur-fitur utama:
      </p>
      
      <div class="architecture-grid">
        <div class="arch-card">
          <div class="arch-icon">✅</div>
          <h3>Implemented</h3>
          <ul class="feature-list">
            <li>Basic HTTP server dengan httprouter</li>
            <li>YAML configuration loading</li>
            <li>Environment variable substitution</li>
            <li>Basic middleware support</li>
            <li>Structured logging</li>
            <li>Graceful shutdown</li>
          </ul>
        </div>
        
        <div class="arch-card">
          <div class="arch-icon">🔄</div>
          <h3>In Progress</h3>
          <ul class="feature-list">
            <li>Pluggable router system (ServeMux integration)</li>
            <li>Listener service abstraction</li>
            <li>RegistrationContext enhancement</li>
            <li>Plugin permission system</li>
            <li>Error handling standardization</li>
          </ul>
        </div>
        
        <div class="arch-card">
          <div class="arch-icon">📋</div>
          <h3>Planned</h3>
          <ul class="feature-list">
            <li>FastHTTP listener support</li>
            <li>HTTP/3 and TLS/mTLS listeners</li>
            <li>Hot configuration reload</li>
            <li>Advanced plugin security sandbox</li>
            <li>Service dependency injection</li>
            <li>Advanced observability (metrics, tracing)</li>
            <li>Secret management integration</li>
            <li>Health check system</li>
            <li>Multi-app deployment patterns</li>
          </ul>
        </div>
      </div>
      
      <div class="performance-notes">
        <h4>📝 Development Notes:</h4>
        <ul>
          <li><strong>Target Release</strong> - Alpha version direncanakan Q3 2025</li>
          <li><strong>Focus Area</strong> - Core framework stability dan developer experience</li>
          <li><strong>Performance</strong> - Benchmark numbers adalah target, bukan hasil actual</li>
          <li><strong>Breaking Changes</strong> - API mungkin berubah significantly sebelum v1.0</li>
          <li><strong>Production Use</strong> - Belum recommended untuk production workloads</li>
        </ul>
      </div>
    </section>
    </main>

  <footer>
    <p>© 2025 Lokstra.dev | Made with ❤️ in Indonesia</p>
  </footer>

  <script>
    // Mobile navigation toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navLinks = document.querySelector('.nav-links');

    navToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active');
    });

    // Close mobile menu when clicking on a link
    document.querySelectorAll('.nav-links a').forEach(link => {
      link.addEventListener('click', () => {
        navLinks.classList.remove('active');
      });
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!navToggle.contains(e.target) && !navLinks.contains(e.target)) {
        navLinks.classList.remove('active');
      }
    });
  </script>
</body>
</html>
